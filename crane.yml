prefix: "dejima-"
services:
  client1:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres1"
    networks: ["net", "client1-net"]
    env:
      - "RAILS_ENV=client_development"
      - "PEER_TYPE=government"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres1.dejima-peer1-net"
    #detach: true
    interactive: true
    tty: true
    volume: ["peer:/peer"]
  peer1:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres1"
    networks: ["net", "peer1-net"]
    env:
      - "RAILS_ENV=peer_development"
      - "PEER_TYPE=government"
      - "PEER_NETWORK_ADDRESS=dejima-peer1.dejima-net"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres1.dejima-peer1-net"
    #detach: true
    interactive: true
    tty: true
    volume: ["peer:/peer"]
  postgres1:
    image: "dfherr/dejima-postgres:latest"
    networks: ["peer1-net", "client1-net"]
    env:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=foobar"
      - "DEJIMA_API_ENDPOINT=dejima-peer1.dejima-peer1-net:3000/dejima/propagate"
    run:
      #detach: true
    exec:
      tty: true
      interactive: true
  peer2:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres2"
    networks: ["net", "peer2-net"]
    env:
      - "RAILS_ENV=peer_development"
      - "PEER_TYPE=bank"
      - "PEER_NETWORK_ADDRESS=dejima-peer2.dejima-net"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres2.dejima-peer2-net"
    #detach: true
    interactive: true
    tty: true
    publish: ["3000:3000"]
    volume: ["peer:/peer"]
  postgres2:
    image: "dfherr/dejima-postgres:latest"
    networks: ["peer2-net"]
    env:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=foobar"
      - "DEJIMA_API_ENDPOINT=dejima-peer2.dejima-peer2-net:3000/dejima/propagate"
    run:
      detach: true
    exec:
      tty: true
      interactive: true
  peer3:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres3"
    networks: ["net", "peer3-net"]
    env:
      - "RAILS_ENV=peer_development"
      - "PEER_TYPE=insurance"
      - "PEER_NETWORK_ADDRESS=dejima-peer3.dejima-net"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres3.dejima-peer3-net"
    #detach: true
    interactive: true
    tty: true
    volume: ["peer:/peer"]
  postgres3:
    image: "dfherr/dejima-postgres:latest"
    networks: ["peer3-net"]
    env:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=foobar"
      - "DEJIMA_API_ENDPOINT=dejima-peer3.dejima-peer3-net:3000/dejima/propagate"
    run:
      detach: true
    exec:
      tty: true
      interactive: true

groups:
  dejima: ["peer1", "peer2", "peer3"]

networks:
  net:
  peer1-net:
  peer2-net:
  peer3-net:
  client1-net:
  client2-net:
  client3-net: