prefix: "dejima-"
services:
  dejima-peer1:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres-peer1"
    networks: ["net", "peer1-net"]
    env:
      - "RAILS_ENV=development"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres-peer1.dejima-peer1-net"
    #detach: true
    interactive: true
    tty: true
    volume: ["peer:/peer"]
  postgres-peer1:
    image: "postgres:11.1-alpine"
    networks: ["peer1-net"]
    env:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=foobar"
    run:
      detach: true
    exec:
      tty: true
      interactive: true
  dejima-peer2:
    image: "dfherr/dejima-prototype:latest"
    requires:
      - "postgres-peer2"
    networks: ["net", "peer2-net"]
    env:
      - "RAILS_ENV=development"
      - "DEJIMA_PEER_DATABASE_HOST=dejima-postgres-peer2.dejima-peer2-net"
    detach: true
    interactive: true
    tty: true
  postgres-peer2:
    image: "postgres:11.1-alpine"
    networks: ["peer2-net"]
    env:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=foobar"
    run:
      detach: true
    exec:
      tty: true
      interactive: true

groups:
  dejima: ["dejima-peer1", "dejima-peer2"]

networks:
  net:
  peer1-net:
  peer2-net: